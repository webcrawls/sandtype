@using System
@using System.Collections.Generic
@using Sandbox.UI
@using TerryTyper.Controller
@using TerryTyper.UI.Text
@inherits Panel
@implements IGamePage
@namespace TerryTyper.UI.Hud.Page.Info
@attribute [StyleSheet]

<root>
	<div class="shop-section">
		<h1 class="title">Themes</h1>
		<div class="shop-items">
			@foreach ( var theme in _themes.Values )
			{
				bool unlocked = _unlockedThemes.Contains( theme.Id );
				string name = theme.Name;
				<ShopItem Unlocked="@(unlocked)"
				          Name="@(name + (_theme == theme.Id ? " (Selected)" : ""))"
				          Price="@(theme.Cost)"
				          ClickAction="@( SelectThemeAction( theme ) )"/>
			}
		</div>
	</div>
</root>

@code {
	public string Name => "Shop";
	public bool ShouldScroll => true;
	private DataController _data => TyperGame.Entity.GamePawn.Data;
	private long _currency => _data.Currency;
	private string _theme => _data.SelectedTheme;
	private IList<string> _unlockedThemes => _data.UnlockedThemes;
	private IDictionary<string, TextTheme> _themes = TextTheme.DefaultThemes;

	private void UnlockTheme( TextTheme theme )
	{
		if ( _unlockedThemes.Contains( theme.Id ) ) return;
		if ( _currency < theme.Cost ) return;
		_data.Currency -= theme.Cost;
		_data.UnlockTheme( theme.Id );
	}

	private Action SelectThemeAction( TextTheme theme )
	{
		return () =>
		{
			if ( !_unlockedThemes.Contains( theme.Id ) )
			{
				UnlockTheme( theme );
				return;
			};
			_data.SelectedTheme = theme.Id;
		};
	}

}
